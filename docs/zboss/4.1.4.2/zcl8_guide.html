<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>Developing with ZBOSS for Zigbee : ZBOSS Zigbee Cluster Library 8 developer guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="logo_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Developing with ZBOSS for Zigbee
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('zcl8_guide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ZBOSS Zigbee Cluster Library 8 developer guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="zcl8_overview"></a>
1. ZCL8 overview</h1>
<h2><a class="anchor" id="zcl8_main_changes"></a>
1.1 List of main cluster changes in ZCL8 specification</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Cluster name </th><th class="markdownTableHeadNone">ZBOSS ZCL8 identifier </th><th class="markdownTableHeadNone">Changes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Color Control Cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_COLOR_CONTROL </td><td class="markdownTableBodyNone">Fields added  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Level control cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_LEVEL_CONTROL </td><td class="markdownTableBodyNone">Fields added  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Scenes cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_SCENES </td><td class="markdownTableBodyNone">Fields added  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Demand-Response cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_DRLC </td><td class="markdownTableBodyNone">Fields added and status codes updated  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Alarms cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_ALARMS </td><td class="markdownTableBodyNone">Status codes updated  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Appliance events and alerts cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_APPLIANCE_EVENTS_AND_ALERTS </td><td class="markdownTableBodyNone">Status codes updated  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Over The Air cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_OTA_UPGRADE </td><td class="markdownTableBodyNone">Optional parameters are not supposed  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Door lock cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_DOOR_LOCK </td><td class="markdownTableBodyNone">Status codes updated  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Groups cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_GROUPS </td><td class="markdownTableBodyNone">Status codes updated  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">IAS ACE cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_IAS_ACE </td><td class="markdownTableBodyNone">Status codes updated  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">IAS WD cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_IAS_WD </td><td class="markdownTableBodyNone">Status codes updated  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">IAS Zone cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_IAS_ZONE </td><td class="markdownTableBodyNone">Status codes updated  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Identify cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_IDENTIFY </td><td class="markdownTableBodyNone">Status codes updated  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Window covering cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_WINDOW_COVERING </td><td class="markdownTableBodyNone">Status codes updated  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">On/Off cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_ON_OFF </td><td class="markdownTableBodyNone">Status codes updated  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Poll control cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_POLL_CONTROL </td><td class="markdownTableBodyNone">Status codes updated  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Works with All Hubs cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_WWAH </td><td class="markdownTableBodyNone">Status codes updated  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Thermostat cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_THERMOSTAT </td><td class="markdownTableBodyNone">Status codes updated  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Time cluster </td><td class="markdownTableBodyNone">ZB_ZCL_CLUSTER_ID_TIME </td><td class="markdownTableBodyNone">Optional parameters were added  </td></tr>
</table>
<h2><a class="anchor" id="zcl8_status_changes"></a>
1.2 ZCL Commands statuses changes introduced in ZCL8 specification</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">pre-ZCL8 status codes </th><th class="markdownTableHeadNone">Changes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">UNSUP_CLUSTER_COMMAND(0x81) </td><td class="markdownTableBodyNone">In ZCL8 renamed to UNSUP_COMMAND  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">UNSUP_GENERAL_COMMAND(0x82) </td><td class="markdownTableBodyNone">In ZCL8 use UNSUP_CLUSTER_COMMAND  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">UNSUP_MANUF_CLUSTER_COMMAND(0x83) </td><td class="markdownTableBodyNone">In ZCL8 use UNSUP_CLUSTER_COMMAND  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">UNSUP_MANUF_GENERAL_COMMAND(0x84) </td><td class="markdownTableBodyNone">In ZCL8 use UNSUP_CLUSTER_COMMAND  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DUPLICATE_EXISTS(0x8a) </td><td class="markdownTableBodyNone">In ZCL8 use Success(0x00)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">WRITE_ONLY(0x8f) </td><td class="markdownTableBodyNone">In ZCL8 use NOT_AUTHORIZED(0x7e)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">INCONSISTENT_STARTUP_STATE(0x90) </td><td class="markdownTableBodyNone">In ZCL8 use FAILURE(0x01)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DEFINED_OUT_OF_BAND(0x91) </td><td class="markdownTableBodyNone">In ZCL8 use FAILURE(0x01)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">INCONSISTENT(0x92) </td><td class="markdownTableBodyNone">In ZCL8 - RESERVED. Never used  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ACTION_DENIED(0x93) </td><td class="markdownTableBodyNone">In ZCL8 use FAILURE(0x01)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">HARDWARE_FAILURE(0xc0) </td><td class="markdownTableBodyNone">In ZCL8 use FAILURE(0x01)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SOFTWARE_FAILURE(0xc1) </td><td class="markdownTableBodyNone">In ZCL8 use FAILURE(0x01)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CALIBRATION_ERROR(0xc2) </td><td class="markdownTableBodyNone">In ZCL8 - RESERVED. Never used  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">LIMIT_REACHED(0xc4) </td><td class="markdownTableBodyNone">In ZCL6 doesn't exist, in ZCL8 use SUCCESS(0x00)  </td></tr>
</table>
<h1><a class="anchor" id="zcl8_design"></a>
2. ZBOSS ZCL8 design</h1>
<h2><a class="anchor" id="zcl8_compatibility"></a>
2.1 Compatibility with previous ZCL specifications</h2>
<p>ZBOSS has been upgraded to support the ZCL8 specification, maintaining backward compatibility with pre-ZCL8 versions according to the ZCL specification requirement. To make the migration process smoother for application developers, ZBOSS ZCL8 introduces a new feature: <a href="#23-backward-compatibility-modes">Backward compatibility modes</a>. Using this functionality, the developer can make flexible decisions about upgrading their applications to ZCL8 or keeping previously implemented products that do not requires new changes.</p>
<h2><a class="anchor" id="zcl8_cluster_revision"></a>
2.2 Cluster revision</h2>
<p>Cluster revision is a mandatory attribute for all Zigbee clusters. This attribute reflects the change history for a specific cluster. Using the attribute value, an application can distinguish between different cluster implementations and features introduced in the new revisions. Additionally, applications can control their behavior, changing the attribute value.</p>
<p>The cluster revision attribute is described in section 2.3.4.5.1.1 ClusterRevision Attribute <a href="#4-references">[1]</a>. The cluster revision attribute reading may be used to ensure that a remote device supports functionality corresponding to the given cluster revision. More details about ClusterRevision usage, examples of changes, and when they are expected to be implemented can be found in <a href="#4-references">[3]</a>.</p>
<h3><a class="anchor" id="zcl8_cluster_revision_how_to"></a>
2.2.1 How to use cluster revision</h3>
<p>It is important to keep in mind that, in the document, cluster revisions for local clusters and peer (remote device) clusters are considered.</p>
<p>The local cluster revision is assigned during the cluster declaration, when <em>ZB_ZCL_DECLARE_&lt;CLUSTER_NAME&gt;_ATTRIB_LIST</em> is being called. The default value for the cluster revision attribute value is the highest revision value supported by ZBOSS. Additionally, the revision can be set manually through <em>ZB_ZCL_SET_ATTRIBUTE</em> API. Note that the revision value passed through the API should not be greater than the highest supported revision. The application may want to decrease the local cluster revision in order to work with old or legacy devices. If the application implements its own cluster declaration, so it doesn't use the ZBOSS cluster declaration, the cluster revision should be initialized properly, otherwise the device will be accepted as a pre-ZCL8 implementation and won't get the advantages of ZBOSS ZCL8.</p>
<p>The peer cluster revision is the cluster revision for the specific remote device. Using peer revision, the application discovers which functionality is supported by the peer and then uses those features. The peer cluster revision can be obtained through the ZCL Read Attribute command. The following code sample initializes, composes, and sends the ZCL Read attribute general command:</p>
<div class="fragment"><div class="line">ZB_ZCL_GENERAL_INIT_READ_ATTR_REQ(buf, cmd_ptr, ZB_ZCL_ENABLE_DEFAULT_RESPONSE);</div>
<div class="line">ZB_ZCL_GENERAL_ADD_ID_READ_ATTR_REQ(cmd_ptr, attr_id);</div>
<div class="line">ZB_ZCL_GENERAL_SEND_READ_ATTR_REQ(buf, cmd_ptr, dst_addr, dst_addr_mode, dst_ep, src_ep, profile_id, cluster_id, cb);</div>
</div><!-- fragment --><p>This is an example of revision requests provided with ZCL8 samples, but you can implement your own because there are no specific rules described in the specification.</p>
<h2><a class="anchor" id="zcl8_compatibility_modes"></a>
2.3 Backward compatibility modes</h2>
<h3><a class="anchor" id="zcl8_comp_legacy_mode"></a>
2.3.1 Legacy mode</h3>
<p>This is the default ZCL backward compatibility mode. The <b>ZB_ZCL_LEGACY_MODE</b> mode is intended for keeping pre-ZCL8 developed applications working with the updated ZBOSS ZCL8 library. No changes in the applications are required, and old, pre-ZCL8 ZBOSS API can still be used. ZCL requests will be sent according to the Cluster revision attributes set for the given cluster. The default cluster revision attribute is the highest supported revision.</p>
<p>In the <b>ZB_ZCL_LEGACY_MODE</b> mode an application can also use the ZBOSS ZCL8 API. The corresponding requests will be transformed in a format according to the cluster revision attribute: if the application revision will be set to the ZCL8 cluster revision and ZCL8 API is called, the request will be sent as is. Otherwise, if the application's revision attribute is set to a lower value, the command format will be downgraded automatically to match the revision format configured by the attribute. In most cases, the downgrade means that all fields which are absent in the format specification for the given revision are cut off.</p>
<p>For example:</p>
<ul>
<li>If a cluster revision attribute is set to a <em>pre-ZCL8</em> value, e.g. the value is 1, and an application calls ZBOSS <em>ZCL8</em> via an API request, the request format in the air will correspond to revision 1</li>
<li>If the value is 3, and an application calls ZBOSS <em>ZCL8</em> via an API request, the request will be formatted according to cluster revision 3.</li>
<li>If a cluster revision attribute is set to any other possible value, and an application calls with a <em>pre-ZCL8</em> API request, the request will always be formatted according to revision 1. API call will "limit" the format in this case.</li>
</ul>
<h3><a class="anchor" id="zcl8_comp_auto_mode"></a>
2.3.2 Auto mode</h3>
<p>The <b>ZB_ZCL_AUTO_MODE</b> mode is intended to automatically convert ZBOSS pre-ZCL8 and ZCL8 API to the format given by the cluster revision attribute. Any ZBOSS ZCL API will be upgraded/downgraded to match the format given by the revision. In case of upgrade, request packet fields will be set to their default values according to ZCL specification. So the main rule in this mode, that own cluster revision attribute will define format of the command which will be send over-the air, regardless of the API used. This mode can be set <em>ONLY</em> manually (see 2.3.4 for details).</p>
<p>For example:</p>
<ul>
<li>If a cluster revision is set to a <em>pre-ZCL8</em> value, e.g. value is 1, and an application calls with a ZBOSS <em>ZCL8</em> API request, the request will be downgraded to the <em>pre-ZCL8</em> format</li>
<li>If the revision is 3, and an application calls with a ZBOSS <em>ZCL8</em> API request, the request will be sent as is, in the <em>ZCL8</em> format</li>
<li>If a cluster revision attribute is set to a <em>pre-ZCL8</em> value, e.g. value is 1, and an application calls with a <em>pre-ZCL8</em> API request, the request will be sent as is, in the <em>pre-ZCL8</em> format</li>
<li>If the revision is 3, the <em>pre-ZCL8</em> API request fields will be extended with default values to match the revision 3 format.</li>
</ul>
<h3><a class="anchor" id="zcl8_comp_compatibility_mode"></a>
2.3.3 Compatibility mode</h3>
<p>The <b>ZB_ZCL_COMPATIBILITY_MODE</b> mode should be supported in the application in order to fully correspond to the ZCL specification. In this mode, it is possible to achieve maximum compatibility with old/broken devices. This mode adds a mechanism of requesting revisions to peers and may cause some delays in command sending under some circumstances. Significant application changes are also required, since the application should maintain a cluster revisions table and implement a full cluster revisions API. This mode can be enabled manually or automatically after the <em>peer_revision_callback</em> is set.</p>
<p>The <em>peer_revision_callback</em> has to be defined according the following signature:</p>
<p><code>typedef zb_uint16_t (*zb_zcl_peer_revision_cb_t) (zb_ieee_addr_t ieee_addr, zb_uint16_t cluster_id, zb_uint8_t cluster_role, zb_uint8_t endpoint);</code></p>
<p>Here is an example using the <em>zb_zcl_set_peer_revision_callback</em> call:</p>
<div class="fragment"><div class="line">zb_uint16_t peer_revision_cb(zb_ieee_addr_t ieee_addr, zb_uint16_t cluster_id, zb_uint8_t cluster_role, zb_uint8_t endpoint)</div>
<div class="line">{</div>
<div class="line">  ...</div>
<div class="line">  return peer_revision;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void foo_init(void)</div>
<div class="line">{</div>
<div class="line">  zb_ret_t ret;</div>
<div class="line">  ...</div>
<div class="line">  ret = zb_zcl_set_peer_revision_callback(peer_revision_cb);</div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <b>ZB_ZCL_COMPATIBILITY_MODE</b> mode implements logic such that when revisions of the command are sent, the revisions will be limited to each peer and its cluster independently. An application must implement <em>peer_revision_callback</em> in order to let ZBOSS ZCL8 retrieve peer cluster revisions, to transform ZCL correctly based on the requests. In the callback function, the application should return revisions requested for the given peer and cluster identified through the callback parameters. It's up to the application implementation to define how the peer revision is obtained. If the revision is unknown, the <em>ZB_ZCL_PEER_CLUSTER_REV_UNKNOWN</em> value should be returned. In both cases, whether the callback is not set, or the <em>ZB_ZCL_PEER_CLUSTER_REV_UNKNOWN</em> value is returned, the minimum possible peer revision will be used for the mode. Please note, the format will be also limited by the set cluster revision attribute.</p>
<h3><a class="anchor" id="zcl8_comp_modes_how_to"></a>
2.3.4 How to use backward compatibility modes</h3>
<p>ZBOSS ZCL8 Backward compatibility modes can be set using the <em>zb_zcl_set_backward_comp_mode</em> call:</p>
<p><code>zb_ret_t ret = zb_zcl_set_backward_comp_mode(ZB_ZCL_LEGACY_MODE);</code></p>
<p>The current mode can be obtained through the <em>zb_zcl_get_backward_comp_mode</em> call:</p>
<p><code>zb_uint8_t mode = <a class="el" href="group___z_b___z_c_l___c_o_m_m_o_n.html#ga210c5c0da994017e12670f0922bdb868" title="Get ZCL backward compatibility modes.">zb_zcl_get_backward_comp_mode()</a>;</code></p>
<p>All <b>ZB_ZCL_LEGACY_MODE</b>, <b>ZB_ZCL_AUTO_MODE</b> and <b>ZB_ZCL_COMPATIBILITY_MODE</b> modes can be set manually. <b>ZB_ZCL_LEGACY_MODE</b> is always the default mode, so long as an application doesn't select another mode intentionally. <b>ZB_ZCL_COMPATIBILITY_MODE</b> is enabled automatically when the <em>zb_zcl_set_peer_revision_callback</em> is called with a non-NULL parameter.</p>
<p>Here is brief overview for the results of ZBOSS pre-ZCL8 and ZCL8 API invocation in various backward compatibility modes:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Backward compatibility mode </th><th class="markdownTableHeadNone">ZBOSS ZCL API version </th><th class="markdownTableHeadNone">Local cluster revision </th><th class="markdownTableHeadNone">Peer cluster revision </th><th class="markdownTableHeadNone">Resulting request format </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ZB_ZCL_LEGACY_MODE </td><td class="markdownTableBodyNone">pre-ZCL8 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">n/a </td><td class="markdownTableBodyNone">limited by API call 1 </td><td class="markdownTableBodyNone">as is  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ZB_ZCL_LEGACY_MODE </td><td class="markdownTableBodyNone">pre-ZCL8 </td><td class="markdownTableBodyNone">default(3) </td><td class="markdownTableBodyNone">n/a </td><td class="markdownTableBodyNone">limited by API call 1 </td><td class="markdownTableBodyNone">as is  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ZB_ZCL_LEGACY_MODE </td><td class="markdownTableBodyNone">ZCL8 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">n/a </td><td class="markdownTableBodyNone">limited by own rev 1 </td><td class="markdownTableBodyNone">downgraded  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ZB_ZCL_LEGACY_MODE </td><td class="markdownTableBodyNone">ZCL8 </td><td class="markdownTableBodyNone">default(3) </td><td class="markdownTableBodyNone">n/a </td><td class="markdownTableBodyNone">same as own revision 3 </td><td class="markdownTableBodyNone">as is  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ZB_ZCL_AUTO_MODE </td><td class="markdownTableBodyNone">pre-ZCL8 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">n/a </td><td class="markdownTableBodyNone">as set in own rev 1 </td><td class="markdownTableBodyNone">as is  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ZB_ZCL_AUTO_MODE </td><td class="markdownTableBodyNone">pre-ZCL8 </td><td class="markdownTableBodyNone">default(3) </td><td class="markdownTableBodyNone">n/a </td><td class="markdownTableBodyNone">as set in own rev 3 </td><td class="markdownTableBodyNone">upgraded  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ZB_ZCL_AUTO_MODE </td><td class="markdownTableBodyNone">ZCL8 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">n/a </td><td class="markdownTableBodyNone">as set in own rev 1 </td><td class="markdownTableBodyNone">downgraded  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ZB_ZCL_AUTO_MODE </td><td class="markdownTableBodyNone">ZCL8 </td><td class="markdownTableBodyNone">default(3) </td><td class="markdownTableBodyNone">n/a </td><td class="markdownTableBodyNone">as set in own rev 3 </td><td class="markdownTableBodyNone">as is  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ZB_ZCL_COMPATIBILITY_MODE </td><td class="markdownTableBodyNone">pre-ZCL8 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">limited by own rev 1 </td><td class="markdownTableBodyNone">as is  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ZB_ZCL_COMPATIBILITY_MODE </td><td class="markdownTableBodyNone">pre-ZCL8 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">limited by own rev 1 </td><td class="markdownTableBodyNone">as is  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ZB_ZCL_COMPATIBILITY_MODE </td><td class="markdownTableBodyNone">pre-ZCL8 </td><td class="markdownTableBodyNone">default(3) </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">limited by peer rev 1 </td><td class="markdownTableBodyNone">as is  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ZB_ZCL_COMPATIBILITY_MODE </td><td class="markdownTableBodyNone">pre-ZCL8 </td><td class="markdownTableBodyNone">default(3) </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">same as own default 3 </td><td class="markdownTableBodyNone">upgraded  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ZB_ZCL_COMPATIBILITY_MODE </td><td class="markdownTableBodyNone">ZCL8 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">limited by own rev 1 </td><td class="markdownTableBodyNone">downgraded  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ZB_ZCL_COMPATIBILITY_MODE </td><td class="markdownTableBodyNone">ZCL8 </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">limited by own rev 1 </td><td class="markdownTableBodyNone">downgraded  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ZB_ZCL_COMPATIBILITY_MODE </td><td class="markdownTableBodyNone">ZCL8 </td><td class="markdownTableBodyNone">default(3) </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">limited by peer rev 1 </td><td class="markdownTableBodyNone">downgraded  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ZB_ZCL_COMPATIBILITY_MODE </td><td class="markdownTableBodyNone">ZCL8 </td><td class="markdownTableBodyNone">default(3) </td><td class="markdownTableBodyNone">3 </td><td class="markdownTableBodyNone">same as own default 3 </td><td class="markdownTableBodyNone">as is  </td></tr>
</table>
<p>NOTE: the cluster revision values in the table are provided as an example to demonstrate possible format conversions.</p>
<h2><a class="anchor" id="zcl8_status_treatment"></a>
2.4 How ZBOSS ZCL8 treats ZCL statuses</h2>
<p>The ZCL8 specification introduces changes in status codes, which are not compatible with pre-ZCL8 codes. Particularly for cases in which ZBOSS ZCL8 adds status code mapping that depends on backward compatibility modes. When <b>ZB_ZCL_LEGACY_MODE</b> is enabled, all statuses are passed as they were in pre-ZCL8 version, in order to maintain compatibility with old applications. For <b>ZB_ZCL_AUTO_MODE</b> and <b>ZB_ZCL_COMPATIBILITY_MODE</b>, all pre-ZCL8 status codes are converted to match their new ZCL8 description (see 1.2.).</p>
<h1><a class="anchor" id="zc8_api"></a>
3. ZBOSS ZCL8 API</h1>
<p>The ZBOSS ZCL8 implementation extends the API with a new macro which can be distinguished in a **_ZCL8** suffix. For example:</p>
<ul>
<li><em><a class="el" href="group___z_b___z_c_l___l_e_v_e_l___c_o_n_t_r_o_l.html#ga587f3a278bd72fd34918c308831a844d" title="Send Move with On/Off command (pre-ZCL8) Use ZB_ZCL_LEVEL_CONTROL_SEND_MOVE_WITH_ON_OFF_REQ_ZCL8 for ...">ZB_ZCL_LEVEL_CONTROL_SEND_MOVE_WITH_ON_OFF_REQ()</a></em> is pre-ZCL8 API</li>
<li><em><a class="el" href="group___z_b___z_c_l___l_e_v_e_l___c_o_n_t_r_o_l.html#gab73da86b231f85305744f33269e91eef" title="Send Move with On/Off command.">ZB_ZCL_LEVEL_CONTROL_SEND_MOVE_WITH_ON_OFF_REQ_ZCL8()</a></em> is ZCL8 API,</li>
</ul>
<p>It's recommended to use macro calls as the primary API for ZCL.</p>
<p>In most cases, the new API adds parameters for corresponding command fields, introduced in the ZCL8 specification. See the full ZBOSS ZCL8 API description in the ZBOSS Development Guide <a href="#4-references">[4]</a>.</p>
<p>For simplicity, if you are not familiar with which cluster command was changed in ZCL8, and if it contains a new API function implementation - you can simply include the supplied optional header <b>zboss_stable/include/zboss_api_zcl8.h</b> and always call macros with the _ZCL8 suffix. In this case, even if the command is equal in pre-ZCL8 as well as in ZCL8, it will be routed to the latest available revision of the command.</p>
<h1><a class="anchor" id="zcl8_references"></a>
4. References</h1>
<p>[1]: 07-5123-08 Zigbee Cluster Library Revision 8 [2]: 07-5123-07 Zigbee Cluster Library Revision 7 [3]: 13-0589-13 ZigBee Application Architecture [4]: ZBOSS Development Guide </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Thu Nov 14 2024" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
